<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Adrenal Nodule Management</title>
    <link rel="stylesheet" href="colors.css">
    <link rel="stylesheet" href="styling/adrenal-nodules.css">
</head>
<body>

<a href="index.html" class="back-btn">‚Üê Back</a>

<div class="tool-container">
    <h1>Incidental Adrenal Nodule Management</h1>
    <h2>Interactive Tool for Management of Asymptomatic Adrenal Masses</h2>

    <div class="form-grid">
        <form id="adrenal-form">
            <fieldset>
                <legend>1. Initial Assessment</legend>
                <div class="radio-group">
                    <label><input type="radio" name="initial" value="benign"> Definite Benign Features</label>
                    <label><input type="radio" name="initial" value="indeterminate"> Indeterminate Features</label>
                </div>
            </fieldset>

            <!-- Indeterminate Options -->
            <div id="indeterminate-options" class="hidden">
                <fieldset>
                    <legend>2. Size Assessment</legend>
                    <div class="radio-group">
                        <label><input type="radio" name="size" value="small"> 1-4 cm</label>
                        <label><input type="radio" name="size" value="large"> ‚â•4 cm</label>
                    </div>
                </fieldset>

                <!-- Large Mass Options -->
                <div id="large-options" class="hidden">
                    <fieldset>
                        <legend>3. Cancer History</legend>
                        <div class="radio-group">
                            <label><input type="radio" name="cancer_history" value="no"> No Cancer History</label>
                            <label><input type="radio" name="cancer_history" value="yes"> Known Cancer History</label>
                        </div>
                    </fieldset>
                </div>

                <!-- Small Mass Options -->
                <div id="small-options" class="hidden">
                    <fieldset>
                        <legend>3. Prior Imaging</legend>
                        <div class="radio-group">
                            <label><input type="radio" name="prior" value="available"> Prior Imaging Available</label>
                            <label><input type="radio" name="prior" value="none"> No Prior Imaging</label>
                        </div>
                    </fieldset>

                    <!-- Prior Imaging Assessment -->
                    <div id="prior-assessment" class="hidden">
                        <fieldset>
                            <legend>4. Stability Assessment</legend>
                            <div class="radio-group">
                                <label><input type="radio" name="stability" value="stable"> Stable ‚â•1 year</label>
                                <label><input type="radio" name="stability" value="new_enlarging"> New or Enlarging</label>
                            </div>
                        </fieldset>
                    </div>

                    <!-- No Prior Options -->
                    <div id="no-prior-assessment" class="hidden">
                        <fieldset>
                            <legend>4. Size Classification</legend>
                            <div class="radio-group">
                                <label><input type="radio" name="size_detail" value="very_small"> 1-2 cm</label>
                                <label><input type="radio" name="size_detail" value="medium"> 2-4 cm</label>
                            </div>
                        </fieldset>

                        <!-- Medium Size CT Assessment -->
                        <div id="ct-assessment" class="hidden">
                            <fieldset>
                                <legend>5. Adrenal CT Results</legend>
                                <div class="radio-group">
                                    <label><input type="radio" name="ct_hu" value="low"> ‚â§10 HU</label>
                                    <label><input type="radio" name="ct_hu" value="high"> >10 HU</label>
                                </div>
                            </fieldset>

                            <!-- Washout Study -->
                            <div id="washout-study" class="hidden">
                                <fieldset>
                                    <legend>6. Washout Study Results</legend>
                                    <div class="radio-group">
                                        <label><input type="radio" name="washout" value="adequate"> APW ‚â•60% or RPW ‚â•40%</label>
                                        <label><input type="radio" name="washout" value="inadequate"> APW <60% and RPW <40%</label>
                                        <label><input type="radio" name="washout" value="no_enhancement"> No Enhancement</label>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button type="button" id="calculate-btn" onclick="calculateRecommendation()">Get Recommendation</button>
        </form>

        <!-- Notes Section -->
        <div class="notes-container">
            <div class="notes-header">
                <h3>Clinical Notes</h3>
            </div>
            
            <div class="notes-section">
                <h4>Definite Benign Features</h4>
                <ul>
                    <li><strong>Myelolipoma:</strong> Contains macroscopic fat (visible fat density)</li>
                    <li><strong>‚â§10 HU:</strong> Unenhanced CT attenuation ‚â§10 HU indicates lipid-rich adenoma</li>
                    <li><strong>No Enhancement:</strong> Lack of contrast enhancement suggests benign nature</li>
                    <li><strong>Calcified:</strong> Peripheral or central calcification patterns</li>
                    <li><strong>CS-MR Signal Drop:</strong> Signal loss on opposed-phase chemical shift MRI</li>
                </ul>
            </div>

            <div class="notes-section">
                <h4>Indeterminate Features</h4>
                <ul>
                    <li><strong>Size matters:</strong> Larger masses (‚â•4 cm) have higher malignancy risk</li>
                    <li><strong>Stability:</strong> Stable for ‚â•1 year suggests benign nature</li>
                    <li><strong>Enhancement pattern:</strong> Irregular or heterogeneous enhancement</li>
                    <li><strong>Density:</strong> >10 HU on unenhanced CT requires further evaluation</li>
                </ul>
            </div>

            <div class="notes-section washout-calculation" id="washout-notes" style="display: none;">
                <h4>üßÆ Washout Calculations</h4>
                <div class="calculation-box">
                    <p><strong>Absolute Percentage Washout (APW):</strong></p>
                    <div class="formula">
                        APW = [(Enhanced HU - Delayed HU) / Enhanced HU] √ó 100
                    </div>
                    <p class="criteria"><strong>Adenoma if APW ‚â•60%</strong></p>
                </div>
                
                <div class="calculation-box">
                    <p><strong>Relative Percentage Washout (RPW):</strong></p>
                    <div class="formula">
                        RPW = [(Enhanced HU - Delayed HU) / (Enhanced HU - Unenhanced HU)] √ó 100
                    </div>
                    <p class="criteria"><strong>Adenoma if RPW ‚â•40%</strong></p>
                </div>
                
                <div class="timing-note">
                    <p><strong>Timing:</strong> Enhanced = 60-70 seconds, Delayed = 15 minutes post-contrast</p>
                </div>
            </div>

            <div class="notes-section" id="additional-considerations">
                <h4>Additional Considerations</h4>
                <ul>
                    <li><strong>Size >4 cm:</strong> Consider surgical evaluation</li>
                    <li><strong>Functional evaluation:</strong> May be needed for symptomatic patients</li>
                </ul>
            </div>
        </div>

        <div id="result-container" class="hidden">
            <h3>Management Recommendation</h3>
            <div id="recommendation"></div>
            <div id="comments"></div>
        </div>
    </div>

    <div class="footer-notes">
        <p><strong>Important Notes:</strong></p>
        <ul>
            <li>APW = Absolute Percentage Washout; RPW = Relative Percentage Washout</li>
            <li>CS-MR = Chemical Shift MRI</li>
            <li>F/U = Follow-up</li>
            <li>Bx = Biopsy</li>
            <li>This tool is for educational purposes. Clinical correlation and institutional guidelines should always be considered.</li>
        </ul>
        <p><em>Based on ACR Appropriateness Criteria and current literature</em></p>
        <p><strong>Reference:</strong> <a href="https://www.jacr.org/article/S1546-1440(17)30551-3/fulltext" target="_blank" rel="noopener">ACR White Paper, Adrenal Nodules</a></p>
    </div>
</div>

<!-- Dialogue box for adrenal CT recommendation -->
<div id="adrenal-ct-dialogue" class="dialogue-box hidden">
    Obtain dedicated Adrenal CT
</div>

<script>
// Show/hide sections based on selections
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('adrenal-form');
    
    form.addEventListener('change', function(e) {
        if (e.target.name === 'initial') {
            hideAllSections();
            clearHighlighting();
            
            if (e.target.value === 'benign') {
                // Automatically show recommendation for benign features
                highlightBenignFeatures();
                showBenignRecommendation();
            } else if (e.target.value === 'indeterminate') {
                // Hide any previous results and show indeterminate options
                document.getElementById('result-container').classList.add('hidden');
                document.getElementById('indeterminate-options').classList.remove('hidden');
                fadeBenignFeatures();
            }
        }
        
        if (e.target.name === 'size') {
            document.getElementById('large-options').classList.add('hidden');
            document.getElementById('small-options').classList.add('hidden');
            clearRecommendations();
            if (e.target.value === 'large') {
                document.getElementById('large-options').classList.remove('hidden');
            } else if (e.target.value === 'small') {
                document.getElementById('small-options').classList.remove('hidden');
            }
        }
        
        if (e.target.name === 'prior') {
            document.getElementById('prior-assessment').classList.add('hidden');
            document.getElementById('no-prior-assessment').classList.add('hidden');
            clearRecommendations();
            if (e.target.value === 'available') {
                document.getElementById('prior-assessment').classList.remove('hidden');
            } else if (e.target.value === 'none') {
                document.getElementById('no-prior-assessment').classList.remove('hidden');
            }
        }
        
        if (e.target.name === 'size_detail') {
            document.getElementById('ct-assessment').classList.add('hidden');
            hideDialogueBox();
            clearRecommendations();
            clearAdditionalConsiderationsHighlight();
            if (e.target.value === 'medium') {
                document.getElementById('ct-assessment').classList.remove('hidden');
                showDialogueBox();
                highlightAdditionalConsiderations();
            }
        }
        
        if (e.target.name === 'ct_hu') {
            document.getElementById('washout-study').classList.add('hidden');
            document.getElementById('washout-notes').style.display = 'none';
            clearRecommendations();
            if (e.target.value === 'high') {
                document.getElementById('washout-study').classList.remove('hidden');
                document.getElementById('washout-notes').style.display = 'block';
            }
        }
        
        // Clear recommendations for any other form field changes
        if (['cancer_history', 'stability', 'washout'].includes(e.target.name)) {
            clearRecommendations();
        }
    });
});

function hideAllSections() {
    const sections = document.querySelectorAll('.hidden');
    sections.forEach(section => section.classList.add('hidden'));
    document.getElementById('result-container').classList.add('hidden');
    clearHighlighting();
    clearSubsequentSelections();
    hideDialogueBox();
}

function clearSubsequentSelections() {
    // Clear all radio button selections except the initial assessment
    const form = document.getElementById('adrenal-form');
    const radioButtons = form.querySelectorAll('input[type="radio"]:not([name="initial"])');
    radioButtons.forEach(radio => {
        radio.checked = false;
    });
}

function clearHighlighting() {
    const notesSections = document.querySelectorAll('.notes-section');
    notesSections.forEach(section => {
        section.classList.remove('highlighted', 'faded');
    });
}

function clearRecommendations() {
    const resultContainer = document.getElementById('result-container');
    if (resultContainer) {
        resultContainer.classList.add('hidden');
    }
}

function showDialogueBox() {
    const dialogueBox = document.getElementById('adrenal-ct-dialogue');
    dialogueBox.classList.remove('hidden');
}

function hideDialogueBox() {
    const dialogueBox = document.getElementById('adrenal-ct-dialogue');
    dialogueBox.classList.add('hidden');
}

function highlightBenignFeatures() {
    const benignSection = document.querySelector('.notes-section:first-of-type');
    if (benignSection) {
        benignSection.classList.add('highlighted');
    }
}

function fadeBenignFeatures() {
    const benignSection = document.querySelector('.notes-section:first-of-type');
    if (benignSection) {
        benignSection.classList.add('faded');
    }
}

function highlightAdditionalConsiderations() {
    const additionalSection = document.getElementById('additional-considerations');
    if (additionalSection) {
        additionalSection.classList.add('highlighted');
    }
}

function clearAdditionalConsiderationsHighlight() {
    const additionalSection = document.getElementById('additional-considerations');
    if (additionalSection) {
        additionalSection.classList.remove('highlighted');
    }
}

function showBenignRecommendation() {
    document.getElementById('recommendation').textContent = 'Benign adrenal adenoma - No follow-up required';
    document.getElementById('comments').textContent = 'Definite benign imaging features confirm adenoma. No further follow-up is required.';
    document.getElementById('result-container').classList.remove('hidden');
    document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
}

function calculateRecommendation() {
    const formData = new FormData(document.getElementById('adrenal-form'));
    let recommendation = '';
    let comments = '';
    
    const initial = formData.get('initial');
    
    // Skip benign processing since it's handled automatically
    if (initial === 'indeterminate') {
        const size = formData.get('size');
        
        if (size === 'large') {
            const cancerHistory = formData.get('cancer_history');
            if (cancerHistory === 'no') {
                recommendation = 'Consider surgical resection';
                comments = 'Large adrenal masses (‚â•4 cm) without cancer history warrant consideration for resection due to increased risk of malignancy.';
            } else if (cancerHistory === 'yes') {
                recommendation = 'Consider biopsy or PET-CT';
                comments = 'Large adrenal masses in patients with known cancer history require tissue sampling or metabolic imaging to exclude metastasis.';
            }
        } else if (size === 'small') {
            const prior = formData.get('prior');
            
            if (prior === 'available') {
                const stability = formData.get('stability');
                if (stability === 'stable') {
                    recommendation = 'Benign - No follow-up required';
                    comments = 'Stability over ‚â•1 year indicates benign nature.';
                } else if (stability === 'new_enlarging') {
                    recommendation = 'Further characterization needed';
                    comments = 'If no history of cancer, obtain follow up CT Adrenal or consider resection.\n\nIf patient has a history of cancer consider PET/CT or biopsy.';
                }
            } else if (prior === 'none') {
                const sizeDetail = formData.get('size_detail');
                
                if (sizeDetail === 'very_small') {
                    recommendation = 'Probably benign - Consider 12-month follow-up adrenal CT';
                    comments = 'Small lesions (1-2 cm) are likely benign but may warrant surveillance.';
                } else if (sizeDetail === 'medium') {
                    const ctHu = formData.get('ct_hu');
                    
                    if (ctHu === 'low') {
                        recommendation = 'Benign adenoma - No follow-up required';
                        comments = 'Attenuation ‚â§10 HU confirms lipid-rich adenoma.';
                    } else if (ctHu === 'high') {
                        const washout = formData.get('washout');
                        
                        if (washout === 'adequate') {
                            recommendation = 'Benign adenoma - No follow-up required';
                            comments = 'Adequate washout (APW ‚â•60% or RPW ‚â•40%) confirms adenoma.';
                        } else if (washout === 'inadequate') {
                            recommendation = 'Indeterminate - Consider imaging follow-up, biopsy, PET-CT, or resection';
                            comments = 'Inadequate washout requires further evaluation depending on clinical scenario.';
                        } else if (washout === 'no_enhancement') {
                            recommendation = 'Benign cystic lesion or hemorrhage. No follow up.';
                            comments = 'Lack of enhancement indicates benign cystic lesion or hemorrhage.';
                        }
                    }
                }
            }
        }
    }
    
    if (recommendation) {
        document.getElementById('recommendation').textContent = recommendation;
        document.getElementById('comments').textContent = comments;
        document.getElementById('result-container').classList.remove('hidden');
        document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
    } else {
        alert('Please complete all required selections to get a recommendation.');
    }
}
</script>

</body>
</html>